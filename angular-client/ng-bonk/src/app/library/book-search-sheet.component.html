<div class="sheet-search-bar" role="search">
  <div class="main-search">
    <mat-form-field class="w-full" appearance="outline">
      <mat-label>Title and/or Author</mat-label>
      <input
        matInput
        [formControl]="searchControl"
        placeholder="Search books"
        autocomplete="off" />
      <mat-icon matSuffix>search</mat-icon>
    </mat-form-field>
  </div>

  <div class="spacer"></div>

  <button mat-button (click)="cancel()">Cancel</button>
</div>

<div class="sheet-container">
  <div class="results-container">
    @if ((loading$ | async) && hasSearched) {
      <div>
        <mat-progress-bar mode="indeterminate" />
      </div>
    }

    @if (results$ | async; as results) {
      @if (hasSearched) {
        @if (results.length > 0) {
          <cdk-virtual-scroll-viewport
            class="results-viewport"
            [itemSize]="itemSize"
            (scrolledIndexChange)="onScrolledIndexChange($event)">
            <mat-card
              class="result-row-card"
              *cdkVirtualFor="let book of results">
              <div class="cover">
                <app-book-cover
                  [src]="getCover(book)"
                [alt]="book.title + ' cover'"></app-book-cover>
              </div>
              <div class="meta">
                <div class="title">{{ book.title }}</div>
                <div class="author">{{ book.author_name?.[0] ?? '—' }}</div>
                <div class="year">{{ book.first_publish_year ?? '—' }}</div>
              </div>
              <div class="actions">
                <button
                  mat-icon-button
                  color="primary"
                  aria-label="Add book"
                  (click)="select(book)">
                  <mat-icon>add</mat-icon>
                </button>
              </div>
            </mat-card>
          </cdk-virtual-scroll-viewport>
        } @else {
          <div class="placeholder">
            No results found. Try a different search.
          </div>
        }
      } @else {
        <div class="placeholder">Enter a search term to find books</div>
      }
    }
  </div>
</div>
