<div class="search-shell">
  <div class="search-header">
    <span class="p-input-icon-left search-input">
      <i class="pi pi-search"></i>
      <input
        pInputText
        [formControl]="searchControl"
        placeholder="Search by title or author"
        autocomplete="off"
      />
    </span>
    <button
      pButton
      type="button"
      icon="pi pi-times"
      class="p-button-text"
      (click)="cancel()"
      aria-label="Close search"
    ></button>
  </div>

  <section class="results" *ngIf="hasSearched">
    <ng-container *ngIf="results.length; else emptyState">
      <ng-container *ngFor="let book of results">
        <p-card class="result-card">
          <div class="result-body">
            <div class="cover">
              <app-book-cover [src]="getCover(book)" [alt]="book.title"></app-book-cover>
            </div>
            <div class="meta">
              <h3>{{ book.title }}</h3>
              <p class="author">{{ book.author_name?.join(', ') || 'Unknown author' }}</p>
              <p class="year" *ngIf="book.first_publish_year">
                First published {{ book.first_publish_year }}
              </p>
            </div>
            <div class="actions">
              <button
                pButton
                type="button"
                icon="pi pi-plus"
                label="Add"
                class="p-button-sm"
                (click)="select(book)"
              ></button>
            </div>
          </div>
        </p-card>
      </ng-container>

      <div class="load-more" *ngIf="hasMore">
        <button
          pButton
          type="button"
          icon="pi pi-chevron-down"
          label="Load more"
          (click)="loadMore()"
          [disabled]="loading"
        ></button>
      </div>
    </ng-container>
  </section>

  <div class="loading" *ngIf="loading">
    <p-progressSpinner strokeWidth="4"></p-progressSpinner>
  </div>
</div>

<ng-template #emptyState>
  <div class="empty">
    <p>No books yet. Try another search.</p>
  </div>
</ng-template>
