<div class="sheet-search-bar" role="search">
  <div class="main-search">
    <mat-form-field class="w-full" appearance="outline">
      <mat-label>Title and/or Author</mat-label>
      <input
        matInput
        [formControl]="searchControl"
        placeholder="Search books"
        autocomplete="off" />
      <mat-icon matSuffix>search</mat-icon>
    </mat-form-field>
  </div>

  <div class="spacer"></div>

  <button mat-button (click)="cancel()">Cancel</button>
</div>

<div class="sheet-container">
  <div class="results-container">
    <div *ngIf="(loading$ | async) && hasSearched">
      <mat-progress-bar mode="indeterminate" />
    </div>

    <ng-container *ngIf="results$ | async as results">
      <ng-container *ngIf="hasSearched; else preSearch">
        <ng-container *ngIf="results.length > 0; else noResults">
          <cdk-virtual-scroll-viewport
            class="results-viewport"
            [itemSize]="itemSize"
            (scrolledIndexChange)="onScrolledIndexChange($event)">
            <mat-card
              class="result-row-card"
              *cdkVirtualFor="let book of results">
              <div class="cover">
                <app-book-cover
                  [src]="getCover(book)"
                  [alt]="book.title + ' cover'"></app-book-cover>
              </div>
              <div class="meta">
                <div class="title">{{ book.title }}</div>
                <div class="author">{{ book.author_name?.[0] ?? '—' }}</div>
                <div class="year">{{ book.first_publish_year ?? '—' }}</div>
              </div>
              <div class="actions">
                <button
                  mat-icon-button
                  color="primary"
                  aria-label="Add book"
                  (click)="select(book)">
                  <mat-icon>add</mat-icon>
                </button>
              </div>
            </mat-card>
          </cdk-virtual-scroll-viewport>
        </ng-container>
        <ng-template #noResults>
          <div class="placeholder">
            No results found. Try a different search.
          </div>
        </ng-template>
      </ng-container>
      <ng-template #preSearch>
        <div class="placeholder">Enter a search term to find books</div>
      </ng-template>
    </ng-container>
  </div>
</div>
