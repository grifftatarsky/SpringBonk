<mat-toolbar id="toolbar-shelves" class="gap-2">
  <button mat-icon-button (click)="refresh()" aria-label="Refresh shelves">
    <mat-icon>refresh</mat-icon>
  </button>
  <div class="toolbar-divider" aria-hidden="true">&nbsp;</div>
  <button mat-button (click)="openCreateDialog()" aria-label="Create shelf">
    <mat-icon>library_add</mat-icon>
    New Shelf
  </button>
  <div class="toolbar-divider" aria-hidden="true">&nbsp;</div>
  <button mat-button (click)="openBookSearchDialog()" aria-label="Add book">
    <mat-icon>menu_book</mat-icon>
    Add Book
  </button>
  <!--Divider, then TODO: chits for categories.-->
  <div class="spacer"></div>
</mat-toolbar>

@if (loading$ | async) {
  <div>
    <mat-progress-bar mode="indeterminate" />
  </div>
}

<div class="shelves-layout" #shelvesLayout>
  <!-- Transition line overlay -->
  @if (showLine) {
    <div
      #transLine
      class="transition-line"
      [class.instant]="lineInstant"
      [ngStyle]="{
        top: lineStyle.top,
        left: lineStyle.left,
        width: lineStyle.width,
      }"></div>
  }

  <!-- Shelves Scrollable Container -->
  <div
    class="list-pane scrollable-container"
    #listPane
    [class.mobile-hidden]="hasSelection$ | async"
    (scroll)="onListScroll($event)">
    <div class="shelves-list">
      @if (shelves$ | async; as shelves) {
        @for (shelf of shelves; track trackByShelfId($index, shelf)) {
          <mat-card
            class="shelf-card"
            [class.active]="(selectedId$ | async) === shelf.id"
            tabindex="0"
            role="button">
            <div
              class="shelf-card-body"
              matRipple
              [matRippleColor]="'rgba(0,255,65,0.3)'"
              [matRippleCentered]="true"
              (click)="onShelfClick(shelf, $event)">
              <div class="shelf-title">{{ shelf.title }}</div>
              <div class="shelf-tags">
                @if (shelf.defaultShelf) {
                  <span class="tag">Default</span>
                }
              </div>
            </div>
          </mat-card>
        }
      } @else {
        <div class="table-no-data-bar">
          No shelves yet. Create your first to get started.
        </div>
      }
    </div>
  </div>

  <!-- Books Scrollable Container -->
  <div
    class="detail-pane scrollable-container"
    #detailPane
    [class.mobile-shown]="hasSelection$ | async">
    <div class="detail-content" #detailContent>
      <router-outlet></router-outlet>
    </div>
  </div>
</div>
