<div class="dialog-shell">
  <div class="book-summary" *ngIf="selectedBook$ | async as current">
    <app-book-cover class="cover" [src]="current.imageURL" [alt]="current.title"></app-book-cover>
    <div class="info">
      <h3>{{ current.title }}</h3>
      <p class="author">{{ current.author }}</p>
      <div class="blurb-actions" *ngIf="current.blurb">
        <p-button
          type="button"
          label="View pitch"
          icon="pi pi-eye"
          class="p-button-text"
          (onClick)="viewBlurb(current)"
        ></p-button>
      </div>
    </div>
  </div>

  <div class="loading" *ngIf="loadingShelves$ | async">
    <p-progressSpinner strokeWidth="3"></p-progressSpinner>
    <span>Loading shelves…</span>
  </div>

  <ng-container *ngIf="!(loadingShelves$ | async)">
    <ng-container *ngIf="config.data?.book; else selectFromShelves"></ng-container>
  </ng-container>

  <ng-template #selectFromShelves>
    <div class="field">
      <label for="shelfSelect">Choose a shelf</label>
      <p-dropdown
        id="shelfSelect"
        [options]="(shelves$ | async) ?? []"
        optionLabel="title"
        optionValue="id"
        [formControl]="shelfControl"
        placeholder="Select shelf"
        filter
        class="w-full"
      ></p-dropdown>
    </div>

    <div class="field" *ngIf="(books$ | async) as shelfBooks">
      <label for="bookSelect">Select a book</label>
      <p-dropdown
        id="bookSelect"
        [options]="shelfBooks"
        optionLabel="title"
        optionValue="id"
        [formControl]="bookControl"
        [disabled]="(loadingBooks$ | async) === true || !shelfBooks.length"
        placeholder="Choose a book"
        filter
        class="w-full"
      ></p-dropdown>
      <div class="loading" *ngIf="loadingBooks$ | async">
        <p-progressSpinner strokeWidth="3"></p-progressSpinner>
        <span>Loading books…</span>
      </div>
    </div>
  </ng-template>

  <div class="existing" *ngIf="existingCandidate$ | async as candidate">
    <p-tag value="Already nominated" severity="warning"></p-tag>
    <p-button
      type="button"
      label="Remove nomination"
      styleClass="p-button-text"
      icon="pi pi-trash"
      (onClick)="removeNomination(candidate.id)"
    ></p-button>
  </div>

  <div class="actions">
    <p-button
      type="button"
      label="Cancel"
      styleClass="p-button-text"
      (onClick)="cancel()"
    ></p-button>
    <p-button
      type="button"
      label="Nominate"
      icon="pi pi-check"
      (onClick)="nominate()"
      [disabled]="!selectedBook || nominating"
    ></p-button>
  </div>
</div>
