<div class="sheet-search-bar" role="search">
  <div class="main-search">
    <mat-form-field class="w-full" appearance="outline">
      <mat-label>Search title or author</mat-label>
      <input
        matInput
        [formControl]="searchControl"
        placeholder="Find a book"
        autocomplete="off"
        [disabled]="submitting" />
      <mat-icon matSuffix>search</mat-icon>
    </mat-form-field>
  </div>

  <div class="spacer"></div>

  <button mat-button (click)="cancel()" [disabled]="submitting">Cancel</button>
</div>

<div class="sheet-container" [class.submitting]="submitting">
  <div class="results-container">
    @if ((loading$ | async) && hasSearched) {
      <mat-progress-bar mode="indeterminate"></mat-progress-bar>
    }

    @if (results$ | async; as results) {
      @if (hasSearched) {
        @if (results.length > 0) {
          <cdk-virtual-scroll-viewport
            class="results-viewport"
            [itemSize]="itemSize"
            (scrolledIndexChange)="onScrolledIndexChange($event)">
            <mat-card class="result-row-card" *cdkVirtualFor="let book of results">
              <div class="cover">
                <app-book-cover
                  [src]="getCover(book)"
                  [alt]="book.title + ' cover'"></app-book-cover>
              </div>
              <div class="meta">
                <div class="title">{{ book.title }}</div>
                <div class="author">{{ book.author_name?.[0] ?? '—' }}</div>
                <div class="year">{{ book.first_publish_year ?? '—' }}</div>
              </div>
              <div class="actions">
                <button
                  mat-stroked-button
                  color="accent"
                  (click)="select(book)"
                  [disabled]="submitting">
                  <mat-icon>how_to_vote</mat-icon>
                  Nominate
                </button>
              </div>
            </mat-card>
          </cdk-virtual-scroll-viewport>
        } @else {
          <div class="placeholder">No results found. Try a different search.</div>
        }
      } @else {
        <div class="placeholder">
          Search Open Library to nominate a new book without leaving this election.
        </div>
      }
    }
  </div>

  @if (submitting) {
    <div class="submitting-overlay">
      <mat-progress-bar mode="indeterminate"></mat-progress-bar>
      <span>Saving nomination…</span>
    </div>
  }
</div>
